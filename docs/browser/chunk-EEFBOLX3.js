import{a as ue,b as he}from"./chunk-RCJALSRH.js";import{a as fe}from"./chunk-PJFUTVME.js";import{a as V,b as O,e as F,g as ae,h as le,i as se,j as pe,k as ce,m as de}from"./chunk-VEIFBABU.js";import{a as me}from"./chunk-L5VL324W.js";import{$ as n,A as T,B as k,F as m,G as u,Ha as N,Ia as Z,Ja as ee,Ka as te,La as ie,Ma as j,Na as ne,O as p,Oa as oe,P as v,W as C,Wa as U,Xa as re,Y as f,aa as o,ba as E,ea as L,fa as g,ga as h,ja as H,ka as K,la as $,ma as l,na as d,oa as z,pa as _,qa as b,ra as y,u as A,v as D,va as Y,wa as G,x as Q,xa as X,ya as J}from"./chunk-QE42GDAH.js";import{a as q,e as R,f as M}from"./chunk-CWTPBX7D.js";var P=R(me());var W=(()=>{let r=class r{constructor(t){this.http=t,this.urlbackend=`${re}/Product`}buscarRegistros(t,e){let i=new j().set("dfecini",t).set("dfecfin",e);return this.http.get(`${this.urlbackend}`,{params:i})}registrarTransaccion(t){return this.http.post(this.urlbackend,t)}exportarRegistros(t,e){let i=new j().set("dfecini",t).set("dfecfin",e);return this.http.get(`${this.urlbackend}/export`,{params:i,responseType:"blob"})}};r.\u0275fac=function(e){return new(e||r)(Q(ne))},r.\u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"});let s=r;return s})();var we=s=>({color:s});function Me(s,r){if(s&1&&(n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),G(9,"date"),o(),n(10,"td"),E(11,"i",17),l(12),o()()),s&2){let a=r.$implicit;p(2),d(a.idTransaction),p(2),d(a.supplies.supplieName),p(2),d(a.quantity),p(2),d(X(9,6,a.transactionDate)),p(3),f("ngStyle",Y(8,we,a.supplieBound==!0?"#57bf31":"#ff2301")),p(),z(" \xA0\xA0",a.supplieBound==!0?"Entrada":"Salida"," ")}}function Ce(s,r){if(s&1&&(n(0,"div",14)(1,"table",15)(2,"thead")(3,"tr")(4,"th"),l(5,"Codigo Transaccion"),o(),n(6,"th"),l(7,"Insumo"),o(),n(8,"th"),l(9,"Cantidad"),o(),n(10,"th"),l(11,"Fecha de Transaccion"),o(),n(12,"th"),l(13,"Entrada/Salida"),o()()(),n(14,"tbody"),C(15,Me,13,10,"tr",16),o()()()),s&2){let a=h();p(15),f("ngForOf",a.transacciones)}}var Se=(()=>{let r=class r{constructor(t){this.suppliesTransactionService=t,this.mostrarTabla=!1,this.dfecini="",this.dfecfin="",this.transacciones=[],this.habilitarExcel=!1}ngOnInit(){let t=new Date;this.dfecini=this.formatDate(t),this.dfecfin=this.formatDate(t)}formatDate(t){let e=t.getFullYear(),i=("0"+(t.getMonth()+1)).slice(-2),c=("0"+t.getDate()).slice(-2);return`${e}-${i}-${c}`}listarkardex(){return M(this,null,function*(){try{let t=yield this.suppliesTransactionService.buscarRegistros(this.dfecini,this.dfecfin).toPromise();console.log(t),this.transacciones=t,this.mostrarTabla=!0,this.habilitarExcel=!0,t.length==0&&(P.default.fire("Informacion","No se encontraron datos de esa fecha","info"),this.mostrarTabla=!1,this.habilitarExcel=!1)}catch(t){P.default.fire("Error","Hubo un error ennla busqueda"+{error:t},"error")}})}exportarExcel(){return M(this,null,function*(){try{let t=yield this.suppliesTransactionService.exportarRegistros(this.formatDate(new Date(this.dfecini)),this.formatDate(new Date(this.dfecfin))).toPromise();if(!t)throw new Error("No se recibi\xF3 el archivo para descargar.");let e=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(e),c=document.createElement("a");c.href=i,c.download=`SuppliesTransactions-${new Date().toISOString()}.xlsx`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(i),document.body.removeChild(c)}catch(t){P.default.fire("Error","No se pudo exportar los datos: "+t,"error")}})}};r.\u0275fac=function(e){return new(e||r)(v(W))},r.\u0275cmp=T({type:r,selectors:[["app-supplies-list"]],decls:25,vars:4,consts:[[1,"container-fluid"],[1,"card-header","d-flex","flex-wrap","align-items-center","justify-content-between"],[1,"mb-3","mb-lg-0"],[1,"d-flex","flex-column","flex-lg-row","align-items-start","align-items-lg-center"],[1,"input-group","me-lg-2","mb-2","mb-lg-0"],[1,"input-group-prepend"],[1,"input-group-text"],["type","date","placeholder","Fecha de Inicio","name","fecIniRep",1,"form-control",3,"ngModelChange","ngModel"],["type","date","placeholder","Fecha de Final","name","fecFinRep",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-sm","btn-outline-primary","me-lg-2","mb-2","mb-lg-0",2,"min-width","130px",3,"click"],[1,"fa","fa-eye"],[1,"btn","btn-sm","btn-outline-success",2,"min-width","140px",3,"click","disabled"],[1,"fa","fa-download"],["class","card-body",4,"ngIf"],[1,"card-body"],[1,"table","table-bordered","table-striped","text-center"],[4,"ngFor","ngForOf"],[1,"fa-solid","fa-circle-dot","fa-lg",3,"ngStyle"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),l(3,"Kardex de Insumos"),o(),n(4,"div",3)(5,"div",4)(6,"div",5)(7,"span",6),l(8,"Inicio"),o()(),n(9,"input",7),y("ngModelChange",function(S){return b(i.dfecini,S)||(i.dfecini=S),S}),o()(),n(10,"div",4)(11,"div",5)(12,"span",6),l(13,"Fin"),o()(),n(14,"input",8),y("ngModelChange",function(S){return b(i.dfecfin,S)||(i.dfecfin=S),S}),o()(),n(15,"div",3)(16,"button",9),g("click",function(){return i.listarkardex()}),n(17,"span"),E(18,"i",10),l(19," \xA0Ver Lista "),o()(),n(20,"button",11),g("click",function(){return i.exportarExcel()}),n(21,"span"),E(22,"i",12),l(23," \xA0Exportar EXCEL "),o()()()()(),C(24,Ce,16,1,"div",13),o()),e&2&&(p(9),_("ngModel",i.dfecini),p(5),_("ngModel",i.dfecfin),p(6),f("disabled",!i.habilitarExcel),p(4),f("ngIf",i.mostrarTabla))},dependencies:[N,Z,ee,V,O,F,te]});let s=r;return s})();var x=R(me());var I=class{constructor(){this.idSupplie=0,this.supplieName="",this.supplieDescription="",this.quantity=0,this.supplieLot=0,this.lotDate=new Date,this.unitOfMesureId=0,this.unitOfMesure=new ue}};var Ee=["createModal"];function ve(s,r){if(s&1){let a=L();n(0,"tr")(1,"td"),l(2),o(),n(3,"td"),l(4),o(),n(5,"td"),l(6),o(),n(7,"td"),l(8),o(),n(9,"td"),l(10),o(),n(11,"td")(12,"button",9),g("click",function(){let e=m(a).$implicit,i=h();return u(i.openEditModal(e))}),E(13,"i",10),o()()()}if(s&2){let a=r.$implicit;p(2),d(a.idSupplie),p(2),d(a.supplieName),p(2),d(a.supplieDescription),p(2),d(a.unitOfMesure.unitName),p(2),d(a.quantity)}}function Ie(s,r){if(s&1&&(n(0,"option",29),l(1),o()),s&2){let a=r.$implicit;f("value",a.idUnitOfMesure),p(),d(a.unitName)}}function De(s,r){if(s&1){let a=L();n(0,"div",11)(1,"h5",12),l(2),o(),n(3,"button",13),g("click",function(){let e=m(a).$implicit;return u(e.dismiss("Cross click"))}),o()(),n(4,"div",14)(5,"div",15)(6,"label",16),l(7,"Nombre"),o(),n(8,"input",17),y("ngModelChange",function(e){m(a);let i=h();return b(i.selectedSupplie.supplieName,e)||(i.selectedSupplie.supplieName=e),u(e)}),o()(),n(9,"div",15)(10,"label",18),l(11,"Descripci\xF3n"),o(),n(12,"input",19),y("ngModelChange",function(e){m(a);let i=h();return b(i.selectedSupplie.supplieDescription,e)||(i.selectedSupplie.supplieDescription=e),u(e)}),o()(),n(13,"div",15)(14,"label",20),l(15,"Cantidad Disponible"),o(),n(16,"input",21),y("ngModelChange",function(e){m(a);let i=h();return b(i.selectedSupplie.quantity,e)||(i.selectedSupplie.quantity=e),u(e)}),g("keydown",function(e){m(a);let i=h();return u(i.onKeyDown(e))}),o()(),n(17,"div",15)(18,"label",20),l(19,"Lote"),o(),n(20,"input",22),y("ngModelChange",function(e){m(a);let i=h();return b(i.selectedSupplie.supplieLot,e)||(i.selectedSupplie.supplieLot=e),u(e)}),g("keydown",function(e){m(a);let i=h();return u(i.onKeyDown(e))}),o()(),n(21,"div",15)(22,"label",23),l(23,"Tipo de Unidad"),o(),n(24,"select",24),y("ngModelChange",function(e){m(a);let i=h();return b(i.selectedSupplie.unitOfMesureId,e)||(i.selectedSupplie.unitOfMesureId=e),u(e)}),C(25,Ie,2,2,"option",25),o()()(),n(26,"div",26)(27,"button",27),g("click",function(){let e=m(a).$implicit;return u(e.dismiss("Cross click"))}),l(28,"Cancelar"),o(),n(29,"button",28),g("click",function(){let e=m(a).$implicit,i=h();return u(i.saveChanges(e))}),l(30),o()()}if(s&2){let a=h();p(2),d(a.isEditMode?"Editar Insumo":"Crear Insumo"),p(6),_("ngModel",a.selectedSupplie.supplieName),f("disabled",a.isEditMode),p(4),_("ngModel",a.selectedSupplie.supplieDescription),f("disabled",a.isEditMode),p(4),_("ngModel",a.selectedSupplie.quantity),p(4),_("ngModel",a.selectedSupplie.supplieLot),f("disabled",a.isEditMode),p(4),_("ngModel",a.selectedSupplie.unitOfMesureId),f("disabled",a.isEditMode),p(),f("ngForOf",a.unitOfMesureList),p(5),d(a.isEditMode?"Guardar Cambios":"Crear Insumo")}}var _e=(()=>{let r=class r{constructor(t,e,i){this.insumosService=t,this.modalService=e,this.suppliesTransactionService=i,this.insumos=[],this.unitOfMesureList=[],this.selectedSupplie=new I,this.isEditMode=!1,this.originalSupplie=new I}ngOnInit(){this.listarInsumo(),this.listarUnidades()}listarInsumo(){return M(this,null,function*(){let t=yield this.insumosService.listarInsumos().toPromise();this.insumos=t})}listarUnidades(){return M(this,null,function*(){let t=yield this.insumosService.listarUnidades().toPromise();this.unitOfMesureList=t})}openCreateModal(){this.selectedSupplie=new I,this.isEditMode=!1,this.modalService.open(this.createModal,{ariaLabelledBy:"openCreateModal"})}openEditModal(t){this.selectedSupplie=q({},t),this.originalSupplie=q({},t),this.isEditMode=!0,this.modalService.open(this.createModal,{ariaLabelledBy:"openEditModal"})}formatDateToOnlyDate(t){let e=t.getFullYear(),i=("0"+(t.getMonth()+1)).slice(-2),c=("0"+t.getDate()).slice(-2);return`${e}-${i}-${c}`}saveChanges(t){return M(this,null,function*(){let e=this.formatDateToOnlyDate(new Date(this.selectedSupplie.lotDate)),i={idSupplie:this.selectedSupplie.idSupplie,supplieName:this.selectedSupplie.supplieName,supplieDescription:this.selectedSupplie.supplieDescription,quantity:this.selectedSupplie.quantity,supplieLot:this.selectedSupplie.supplieLot,lotDate:e,unitOfMesureId:this.selectedSupplie.unitOfMesureId,unitOfMesure:this.selectedSupplie.unitOfMesure},c;if(this.isEditMode){let w=this.selectedSupplie.quantity-this.originalSupplie.quantity;c={idSupplie:this.selectedSupplie.idSupplie,quantity:Math.abs(w),transactionDate:new Date,supplieBound:w>0}}else c={idSupplie:this.selectedSupplie.idSupplie,quantity:this.selectedSupplie.quantity,transactionDate:new Date,supplieBound:!0};if((yield x.default.fire({title:"Cuidado",text:"\xBFEst\xE1 seguro de guardar los cambios?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"S\xED",cancelButtonText:"No"})).isConfirmed)try{if(this.isEditMode)yield this.insumosService.actualizarInsumo(i).toPromise(),console.log(c),yield this.suppliesTransactionService.registrarTransaccion(c).toPromise(),this.listarInsumo(),x.default.fire("Cambios guardados!","El elemento ha sido actualizado.","success");else{let w=yield this.insumosService.crearInsumo(i).toPromise();if(w&&w.idSupplie)c.idSupplie=w.idSupplie,yield this.suppliesTransactionService.registrarTransaccion(c).toPromise(),this.listarInsumo(),x.default.fire("Cambios guardados!","El elemento ha sido creado.","success");else throw new Error("Error al obtener el ID del nuevo insumo")}}catch{x.default.fire("Error","Hubo un error al guardar los cambios.","error")}else x.default.fire("Cancelado","La acci\xF3n ha sido cancelada","info");t.close()})}onKeyDown(t){let e=t.keyCode||t.which;(e<48||e>57)&&e!==8&&(t.preventDefault(),x.default.fire("Cuidado!","Solo puede ingresar numeros","info")),(e===189||e===109)&&(t.preventDefault(),x.default.fire("Cuidado!","No puede ingresar numeros negativos","info"))}};r.\u0275fac=function(e){return new(e||r)(v(he),v(fe),v(W))},r.\u0275cmp=T({type:r,selectors:[["app-supplies-maintenance"]],viewQuery:function(e,i){if(e&1&&H(Ee,5),e&2){let c;K(c=$())&&(i.createModal=c.first)}},decls:26,vars:1,consts:[["createModal",""],[1,"container-fluid"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],["type","button",1,"btn","btn-outline-success",3,"click"],[1,"fa-solid","fa-plus","fa-2xl",2,"color","#63E6BE"],[1,"card-body"],[1,"table","table-bordered","table-striped","text-center"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-transparent",3,"click"],[1,"fa-regular","fa-pen-to-square","fa-xl",2,"color","#2657ab"],[1,"modal-header"],["id","createModalLabel",1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],["for","createSupplieName",1,"form-label"],["type","text","id","createSupplieName",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","createSupplieDescription",1,"form-label"],["type","text","id","createSupplieDescription",1,"form-control",3,"ngModelChange","ngModel","disabled"],["for","createQuantity",1,"form-label"],["type","number","id","createQuantity","min","0",1,"form-control",3,"ngModelChange","keydown","ngModel"],["type","number","id","createQuantity","min","0",1,"form-control",3,"ngModelChange","keydown","ngModel","disabled"],["for","createUnitOfMesureId",1,"form-label"],["id","createUnitOfMesureId",1,"form-select",3,"ngModelChange","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"value"]],template:function(e,i){if(e&1){let c=L();n(0,"div",1)(1,"div",2)(2,"h1",3),l(3,"Listado de Insumos Disponibles"),o(),n(4,"button",4),g("click",function(){return m(c),u(i.openCreateModal())}),E(5,"i",5),o()(),n(6,"div",6)(7,"table",7)(8,"thead")(9,"tr")(10,"th"),l(11,"Codigo"),o(),n(12,"th"),l(13,"Nombre"),o(),n(14,"th"),l(15,"Descripcion"),o(),n(16,"th"),l(17,"Tipo de Unidad"),o(),n(18,"th"),l(19,"Cantidad Disponible"),o(),n(20,"th"),l(21,"Accion"),o()()(),n(22,"tbody"),C(23,ve,14,5,"tr",8),o()()(),C(24,De,31,12,"ng-template",null,0,J),o()}e&2&&(p(23),f("ngForOf",i.insumos))},dependencies:[N,se,pe,V,ae,le,O,ce,F]});let s=r;return s})();var Te=[{path:"supplies-maintenance",component:_e},{path:"supplies-list",component:Se}],be=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=k({type:r}),r.\u0275inj=D({imports:[U.forChild(Te),U]});let s=r;return s})();var et=(()=>{let r=class r{};r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=k({type:r}),r.\u0275inj=D({imports:[ie,be,oe,de]});let s=r;return s})();export{et as SuppliesModule};
